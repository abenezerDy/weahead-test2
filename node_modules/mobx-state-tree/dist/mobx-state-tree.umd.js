!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("mobx")):"function"==typeof define&&define.amd?define(["exports","mobx"],e):e((t=t||self).mobxStateTree={},t.mobx)}(this,function(t,c){"use strict";var h,e,n="warn";function r(t){n=t}function i(){return n}(e=h||(h={})).afterCreate="afterCreate",e.afterAttach="afterAttach",e.afterCreationFinalization="afterCreationFinalization",e.beforeDetach="beforeDetach",e.beforeDestroy="beforeDestroy";var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;0<=s;s--)(i=t[s])&&(a=(o<3?i(a):3<o?i(e,n,a):i(e,n))||a);return 3<o&&a&&Object.defineProperty(e,n,a),a}function u(t){return rt(t).type}function f(t,e){return rt(t).onPatch(e)}function l(t,e){rt(t).applyPatches(gt(e))}function d(t,e){return rt(t).applySnapshot(e)}function y(t){return rt(t).root.storedValue}function v(t){return rt(t).path}function b(t){return rt(t).identifier}function g(t,e){var n=ut(rt(t),e,!1);if(void 0!==n)try{return n.value}catch(t){return}}function m(t){return rt(t).observableIsAlive}function w(t){var e;return{name:(e=nt(t)?u(t):t).name,properties:a({},e.properties)}}var _,S,P=function(){function t(t,e,n,r){this.type=t,this.environment=r,this._state=K.INITIALIZING,this.environment=r,this.baseSetParent(e,n)}return Object.defineProperty(t.prototype,"subpath",{get:function(){return this._subpath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subpathUponDeath",{get:function(){return this._subpathUponDeath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathUponDeath",{get:function(){return this._pathUponDeath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.type.getValue(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(t){var e=this.isAlive;this._state=t;var n=this.isAlive;this.aliveAtom&&e!==n&&this.aliveAtom.reportChanged()},enumerable:!0,configurable:!0}),t.prototype.fireInternalHook=function(t){this._hookSubscribers&&this._hookSubscribers.emit(t,this,t)},t.prototype.registerHook=function(t,e){return this._hookSubscribers||(this._hookSubscribers=new It),this._hookSubscribers.register(t,e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),t.prototype.baseSetParent=function(t,e){this._parent=t,this._subpath=e,this._escapedSubpath=void 0,this.pathAtom&&this.pathAtom.reportChanged()},Object.defineProperty(t.prototype,"path",{get:function(){return this.getEscapedPath(!0)},enumerable:!0,configurable:!0}),t.prototype.getEscapedPath=function(t){return t&&(this.pathAtom||(this.pathAtom=c.createAtom("path")),this.pathAtom.reportObserved()),this.parent?(void 0===this._escapedSubpath&&(this._escapedSubpath=this._subpath?Nt(this._subpath):""),this.parent.getEscapedPath(t)+"/"+this._escapedSubpath):""},Object.defineProperty(t.prototype,"isRoot",{get:function(){return null===this.parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAlive",{get:function(){return this.state!==K.DEAD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDetaching",{get:function(){return this.state===K.DETACHING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"observableIsAlive",{get:function(){return this.aliveAtom||(this.aliveAtom=c.createAtom("alive")),this.aliveAtom.reportObserved(),this.isAlive},enumerable:!0,configurable:!0}),t.prototype.baseFinalizeCreation=function(t){if(this.state===K.CREATED){if(this.parent){if(this.parent.state!==K.FINALIZED)return;this.fireHook(h.afterAttach)}this.state=K.FINALIZED,t&&t()}},t.prototype.baseFinalizeDeath=function(){this._hookSubscribers&&this._hookSubscribers.clearAll(),this._subpathUponDeath=this._subpath,this._pathUponDeath=this.getEscapedPath(!1),this.baseSetParent(null,""),this.state=K.DEAD},t.prototype.baseAboutToDie=function(){this.fireHook(h.beforeDestroy)},t}(),A=function(a){function t(t,e,n,r,i){var o=a.call(this,t,e,n,r)||this;try{o.storedValue=t.createNewInstance(i)}catch(t){throw o.state=K.DEAD,t}return o.state=K.CREATED,o.finalizeCreation(),o}return s(t,a),Object.defineProperty(t.prototype,"root",{get:function(){if(!this.parent)throw dt("This scalar node is not part of a tree");return this.parent.root},enumerable:!0,configurable:!0}),t.prototype.setParent=function(t,e){if(void 0===e&&(e=null),this.parent!==t||this.subpath!==e)if(this.parent&&!t)this.die();else{var n=null===e?"":e;if(t&&t!==this.parent)throw dt("assertion failed: scalar nodes cannot change their parent");this.subpath!==n&&this.baseSetParent(this.parent,n)}},Object.defineProperty(t.prototype,"snapshot",{get:function(){return St(this.getSnapshot())},enumerable:!0,configurable:!0}),t.prototype.getSnapshot=function(){return this.type.getSnapshot(this)},t.prototype.toString=function(){return this.type.name+"@"+(this.path||"<root>")+(this.isAlive?"":"[dead]")},t.prototype.die=function(){this.state!==K.DETACHING&&(this.aboutToDie(),this.finalizeDeath())},t.prototype.finalizeCreation=function(){this.baseFinalizeCreation()},t.prototype.aboutToDie=function(){this.baseAboutToDie()},t.prototype.finalizeDeath=function(){this.baseFinalizeDeath()},t.prototype.fireHook=function(t){this.fireInternalHook(t)},p([c.action],t.prototype,"die",null),t}(P),I=1,T={onError:function(t){throw t}},C=function(u){function r(t,e,n,r,i){var o=u.call(this,t,e,n,r)||this;if(o.nodeId=++I,o.isProtectionEnabled=!0,o.middlewares=null,o._autoUnbox=!0,o._isRunningAction=!1,o._hasSnapshotReaction=!1,o._observableInstanceState=0,o._cachedInitialSnapshotCreated=!1,o.unbox=o.unbox.bind(o),o._initialSnapshot=St(i),o.identifierAttribute=t.identifierAttribute,e||(o.identifierCache=new X),o._childNodes=t.initializeChildNodes(o,o._initialSnapshot),o.identifier=null,o.unnormalizedIdentifier=null,o.identifierAttribute&&o._initialSnapshot){var a=o._initialSnapshot[o.identifierAttribute];if(void 0===a){var s=o._childNodes[o.identifierAttribute];s&&(a=s.value)}if("string"!=typeof a&&"number"!=typeof a)throw dt("Instance identifier '"+o.identifierAttribute+"' for type '"+o.type.name+"' must be a string or a number");o.identifier=De(a),o.unnormalizedIdentifier=a}return e?e.root.identifierCache.addNodeToCache(o):o.identifierCache.addNodeToCache(o),o}return s(r,u),r.prototype.applyPatches=function(t){this.createObservableInstanceIfNeeded(),this._applyPatches(t)},r.prototype.applySnapshot=function(t){this.createObservableInstanceIfNeeded(),this._applySnapshot(t)},r.prototype.createObservableInstanceIfNeeded=function(){if(0===this._observableInstanceState){this._observableInstanceState=1;for(var t=[],e=this.parent;e&&0===e._observableInstanceState;)t.unshift(e),e=e.parent;for(var n=0,r=t;n<r.length;n++){r[n].createObservableInstanceIfNeeded()}var i,o,a=this.type;try{this.storedValue=a.createNewInstance(this,this._childNodes,this._initialSnapshot),this.preboot(),this._isRunningAction=!0,a.finalizeNewInstance(this,this.storedValue)}catch(t){throw this.state=K.DEAD,t}finally{this._isRunningAction=!1}this._observableInstanceState=2,i=this,o="snapshot",c.getAtom(i,o).trackAndCompute(),this.isRoot&&this._addSnapshotReaction(),this._childNodes=ft,this.state=K.CREATED,this.fireHook(h.afterCreate),this.finalizeCreation()}},Object.defineProperty(r.prototype,"root",{get:function(){var t=this.parent;return t?t.root:this},enumerable:!0,configurable:!0}),r.prototype.setParent=function(t,e){if(void 0===e&&(e=null),this.parent!==t||this.subpath!==e)if(this.parent&&!t)this.die();else{var n=null===e?"":e;t&&t!==this.parent?(t.root.identifierCache.mergeCache(this),this.baseSetParent(t,n),this.fireHook(h.afterAttach)):this.subpath!==n&&this.baseSetParent(this.parent,n)}},r.prototype.fireHook=function(t){var e=this;this.fireInternalHook(t);var n=this.storedValue&&"object"==typeof this.storedValue&&this.storedValue[t];"function"==typeof n&&(c._allowStateChangesInsideComputed?c._allowStateChangesInsideComputed(function(){n.apply(e.storedValue)}):n.apply(this.storedValue))},Object.defineProperty(r.prototype,"snapshot",{get:function(){return St(this.getSnapshot())},enumerable:!0,configurable:!0}),r.prototype.getSnapshot=function(){return this.isAlive?2===this._observableInstanceState?this._getActualSnapshot():this._getCachedInitialSnapshot():this._snapshotUponDeath},r.prototype._getActualSnapshot=function(){return this.type.getSnapshot(this)},r.prototype._getCachedInitialSnapshot=function(){if(!this._cachedInitialSnapshotCreated){var t=this.type,e=this._childNodes,n=this._initialSnapshot;this._cachedInitialSnapshot=t.processInitialSnapshot(e,n),this._cachedInitialSnapshotCreated=!0}return this._cachedInitialSnapshot},r.prototype.isRunningAction=function(){return!!this._isRunningAction||!this.isRoot&&this.parent.isRunningAction()},r.prototype.assertAlive=function(t){var e=i();if(!this.isAlive&&"ignore"!==e){var n=this._getAssertAliveError(t);switch(e){case"error":throw dt(n);case"warn":Et(n)}}},r.prototype._getAssertAliveError=function(t){var e=this.getEscapedPath(!1)||this.pathUponDeath||"",n=t.subpath&&Nt(t.subpath)||"",r=t.actionContext||M,i="";r&&null!=r.name&&(i=(r&&r.context&&v(r.context)||e)+"."+r.name+"()");return"You are trying to read or write to an object that is no longer part of a state tree. (Object type: '"+this.type.name+"', Path upon death: '"+e+"', Subpath: '"+n+"', Action: '"+i+"'). Either detach nodes first, or don't use objects after removing / replacing them in the tree."},r.prototype.getChildNode=function(t){this.assertAlive({subpath:t}),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildNode(this,t):this._childNodes[t]}finally{this._autoUnbox=!0}},r.prototype.getChildren=function(){this.assertAlive(ft),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildren(this):ct(this._childNodes)}finally{this._autoUnbox=!0}},r.prototype.getChildType=function(t){return this.type.getChildType(t)},Object.defineProperty(r.prototype,"isProtected",{get:function(){return this.root.isProtectionEnabled},enumerable:!0,configurable:!0}),r.prototype.assertWritable=function(t){if(this.assertAlive(t),!this.isRunningAction()&&this.isProtected)throw dt("Cannot modify '"+this+"', the object is protected and can only be modified by using an action.")},r.prototype.removeChild=function(t){this.type.removeChild(this,t)},r.prototype.unbox=function(t){return t&&this.assertAlive({subpath:t.subpath||t.subpathUponDeath}),t&&this._autoUnbox?t.value:t},r.prototype.toString=function(){var t=this.identifier?"(id: "+this.identifier+")":"";return this.type.name+"@"+(this.path||"<root>")+t+(this.isAlive?"":"[dead]")},r.prototype.finalizeCreation=function(){var n=this;this.baseFinalizeCreation(function(){for(var t=0,e=n.getChildren();t<e.length;t++){e[t].finalizeCreation()}n.fireInternalHook(h.afterCreationFinalization)})},r.prototype.detach=function(){if(!this.isAlive)throw dt("Error while detaching, node is not alive.");if(!this.isRoot){this.fireHook(h.beforeDetach),this.state=K.DETACHING;var t=this.root,e=t.environment,n=t.identifierCache.splitCache(this);try{this.parent.removeChild(this.subpath),this.baseSetParent(null,""),this.environment=e,this.identifierCache=n}finally{this.state=K.FINALIZED}}},r.prototype.preboot=function(){var n=this;this._applyPatches=L(this.storedValue,"@APPLY_PATCHES",function(t){t.forEach(function(t){var e=xt(t.path);pt(n,e.slice(0,-1)).applyPatchLocally(e[e.length-1],t)})}),this._applySnapshot=L(this.storedValue,"@APPLY_SNAPSHOT",function(t){if(t!==n.snapshot)return n.type.applySnapshot(n,t)}),Pt(this.storedValue,"$treenode",this),Pt(this.storedValue,"toJSON",ot)},r.prototype.die=function(){this.state!==K.DETACHING&&(2===this._observableInstanceState?(this.aboutToDie(),this.finalizeDeath()):this.unregisterIdentifiers())},r.prototype.aboutToDie=function(){this.getChildren().forEach(function(t){t.aboutToDie()}),this.baseAboutToDie(),this._internalEventsEmit("dispose"),this._internalEventsClear("dispose")},r.prototype.unregisterIdentifiers=function(){var n=this;Object.keys(this._childNodes).forEach(function(t){var e=n._childNodes[t];e instanceof r&&e.unregisterIdentifiers()}),this.root.identifierCache.notifyDied(this)},r.prototype.finalizeDeath=function(){this.getChildren().forEach(function(t){t.finalizeDeath()}),this.root.identifierCache.notifyDied(this);var t=this.snapshot;this._snapshotUponDeath=t,this._internalEventsClearAll(),this.baseFinalizeDeath()},r.prototype.onSnapshot=function(t){return this._addSnapshotReaction(),this._internalEventsRegister("snapshot",t)},r.prototype.emitSnapshot=function(t){this._internalEventsEmit("snapshot",t)},r.prototype.onPatch=function(t){return this._internalEventsRegister("patch",t)},r.prototype.emitPatch=function(t,e){if(this._internalEventsHasSubscribers("patch")){var n=function(t){if(!("oldValue"in t))throw dt("Patches without `oldValue` field cannot be inversed");return[function(t){switch(t.op){case"add":return{op:"add",path:t.path,value:t.value};case"remove":return{op:"remove",path:t.path};case"replace":return{op:"replace",path:t.path,value:t.value}}}(t),function(t){switch(t.op){case"add":return{op:"remove",path:t.path};case"remove":return{op:"add",path:t.path,value:t.oldValue};case"replace":return{op:"replace",path:t.path,value:t.oldValue}}}(t)]}(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++){var i=e[r];for(var o in i)t[o]=i[o]}return t}({},t,{path:e.path.substr(this.path.length)+"/"+t.path})),r=n[0],i=n[1];this._internalEventsEmit("patch",r,i)}this.parent&&this.parent.emitPatch(t,e)},r.prototype.hasDisposer=function(t){return this._internalEventsHas("dispose",t)},r.prototype.addDisposer=function(t){if(this.hasDisposer(t))throw dt("cannot add a disposer when it is already registered for execution");this._internalEventsRegister("dispose",t,!0)},r.prototype.removeDisposer=function(t){if(!this._internalEventsHas("dispose",t))throw dt("cannot remove a disposer which was never registered for execution");this._internalEventsUnregister("dispose",t)},r.prototype.removeMiddleware=function(e){this.middlewares&&(this.middlewares=this.middlewares.filter(function(t){return t.handler!==e}))},r.prototype.addMiddleWare=function(t,e){var n=this;return void 0===e&&(e=!0),this.middlewares?this.middlewares.push({handler:t,includeHooks:e}):this.middlewares=[{handler:t,includeHooks:e}],function(){n.removeMiddleware(t)}},r.prototype.applyPatchLocally=function(t,e){this.assertWritable({subpath:t}),this.createObservableInstanceIfNeeded(),this.type.applyPatchLocally(this,t,e)},r.prototype._addSnapshotReaction=function(){var e=this;if(!this._hasSnapshotReaction){var t=c.reaction(function(){return e.snapshot},function(t){return e.emitSnapshot(t)},T);this.addDisposer(t),this._hasSnapshotReaction=!0}},r.prototype._internalEventsHasSubscribers=function(t){return!!this._internalEvents&&this._internalEvents.hasSubscribers(t)},r.prototype._internalEventsRegister=function(t,e,n){return void 0===n&&(n=!1),this._internalEvents||(this._internalEvents=new It),this._internalEvents.register(t,e,n)},r.prototype._internalEventsHas=function(t,e){return!!this._internalEvents&&this._internalEvents.has(t,e)},r.prototype._internalEventsUnregister=function(t,e){this._internalEvents&&this._internalEvents.unregister(t,e)},r.prototype._internalEventsEmit=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._internalEvents&&(e=this._internalEvents).emit.apply(e,[t].concat(n))},r.prototype._internalEventsClear=function(t){this._internalEvents&&this._internalEvents.clear(t)},r.prototype._internalEventsClearAll=function(){this._internalEvents&&this._internalEvents.clearAll()},p([c.action],r.prototype,"createObservableInstanceIfNeeded",null),p([c.computed],r.prototype,"snapshot",null),p([c.action],r.prototype,"detach",null),p([c.action],r.prototype,"die",null),r}(P);(S=_||(_={}))[S.String=1]="String",S[S.Number=2]="Number",S[S.Boolean=4]="Boolean",S[S.Date=8]="Date",S[S.Literal=16]="Literal",S[S.Array=32]="Array",S[S.Map=64]="Map",S[S.Object=128]="Object",S[S.Frozen=256]="Frozen",S[S.Optional=512]="Optional",S[S.Reference=1024]="Reference",S[S.Identifier=2048]="Identifier",S[S.Late=4096]="Late",S[S.Refinement=8192]="Refinement",S[S.Union=16384]="Union",S[S.Null=32768]="Null",S[S.Undefined=65536]="Undefined",S[S.Integer=131072]="Integer",S[S.Custom=262144]="Custom",S[S.SnapshotProcessor=524288]="SnapshotProcessor";var V="cannotDetermine",E=function(){function t(t){this.isType=!0,this.name=t}return t.prototype.create=function(t,e){return this.instantiate(null,"",e,t).value},t.prototype.getSnapshot=function(t,e){return void 0===e&&(e=!0),t.type.getSnapshot(t,e)},t.prototype.isAssignableFrom=function(t){return t===this},t.prototype.validate=function(t,e){if(it(t)){var n=u(t);return this.isAssignableFrom(n)?J():Y(e,t)}return this.isValidSnapshot(t,e)},t.prototype.is=function(t){return 0===this.validate(t,[{path:"",type:this}]).length},Object.defineProperty(t.prototype,"Type",{get:function(){throw dt("Factory.Type should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.Type`")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SnapshotType",{get:function(){throw dt("Factory.SnapshotType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.SnapshotType`")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CreationType",{get:function(){throw dt("Factory.CreationType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.CreationType`")},enumerable:!0,configurable:!0}),p([c.action],t.prototype,"create",null),t}(),O=function(n){function t(t){return n.call(this,t)||this}return s(t,n),t.prototype.create=function(t,e){return void 0===t&&(t=this.getDefaultSnapshot()),n.prototype.create.call(this,t,e)},t.prototype.getValue=function(t){return t.createObservableInstanceIfNeeded(),t.storedValue},t.prototype.reconcile=function(t,e){if(!t.isDetaching){if(t.snapshot===e)return t;if(nt(e)&&rt(e)===t)return t;if(t.type===this&&wt(e)&&!nt(e)&&(!t.identifierAttribute||t.identifier===De(e[t.identifierAttribute])))return t.applySnapshot(e),t}var n=t.parent,r=t.subpath;if(t.die(),nt(e)&&this.isAssignableFrom(u(e))){var i=rt(e);return i.setParent(n,r),i}return this.instantiate(n,r,t.environment,e)},t.prototype.getSubTypes=function(){return null},p([c.action],t.prototype,"create",null),t}(E),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.createNewInstance=function(t){return t},e.prototype.getValue=function(t){return t.storedValue},e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.reconcile=function(t,e){if(!t.isDetaching&&t.type===this&&t.storedValue===e)return t;var n=this.instantiate(t.parent,t.subpath,t.environment,e);return t.die(),n},e.prototype.getSubTypes=function(){return null},e}(E);function j(t){return"object"==typeof t&&t&&!0===t.isType}var D=new Map;function x(t){return{$MST_UNSERIALIZABLE:!0,type:t}}function R(e,t){c.runInAction(function(){gt(t).forEach(function(t){return function(t,e){var n=g(t,e.path||"");if(!n)throw dt("Invalid action path: "+(e.path||""));var r=rt(n);if("@APPLY_PATCHES"===e.name)return l.call(null,n,e.args[0]);if("@APPLY_SNAPSHOT"===e.name)return d.call(null,n,e.args[0]);if("function"!=typeof n[e.name])throw dt("Action '"+e.name+"' does not exist in '"+r.path+"'");return n[e.name].apply(n,e.args?e.args.map(function(t){return(e=t)&&"object"==typeof e&&"$MST_DATE"in e?new Date(e.$MST_DATE):e;var e}):[])}(e,t)})})}function k(o,a,s){return void 0===s&&(s=!1),U(o,function(n,t){if("action"!==n.type||n.id!==n.rootId)return t(n);var e=rt(n.context),r={name:n.name,path:st(rt(o),e),args:n.args.map(function(t,e){return function(t,e,n,r){if(r instanceof Date)return{$MST_DATE:r.getTime()};if(_t(r))return r;if(nt(r))return x("[MSTNode: "+u(r).name+"]");if("function"==typeof r)return x("[function]");if("object"==typeof r&&!mt(r)&&!bt(r))return x("[object "+(r&&r.constructor&&r.constructor.name||"Complex Object")+"]");try{return JSON.stringify(r),r}catch(t){return x(""+t)}}(0,n.name,0,t)})};if(s){var i=t(n);return a(r),i}return a(r),t(n)})}var z=1,M=null;function H(){return z++}function F(t,e){var n=rt(t.context),r=n._isRunningAction,i=M;"action"===t.type&&n.assertAlive({actionContext:t}),n._isRunningAction=!0,M=t;try{return function(t,e,a){var s=function(t,e,n){var r=n.$mst_middleware||ht,i=t;for(;i;)i.middlewares&&(r=r.concat(i.middlewares)),i=i.parent;return r}(t,0,a);if(!s.length)return c.action(a).apply(null,e.args);var u=0,p=null;return function r(t){var e=s[u++];var n=e&&e.handler;if(!n)return c.action(a).apply(null,t.args);if(!e.includeHooks&&h[t.name])return r(t);function i(t,e){var n=r(t);p=e?e(n):n}function o(t){p=t}n(t,i,o);return p}(e)}(n,t,e)}finally{M=i,n._isRunningAction=r}}function L(e,n,r){var t=function(){var t=H();return F({type:"action",name:n,id:t,args:Tt(arguments),context:e,tree:y(e),rootId:M?M.rootId:t,parentId:M?M.id:0,allParentIds:M?M.allParentIds.concat([M.id]):[]},r)};return t._isMSTAction=!0,t}function U(t,e,n){return void 0===n&&(n=!0),rt(t).addMiddleWare(e,n)}function $(t){return"function"==typeof t?"<function"+(t.name?" "+t.name:"")+">":nt(t)?"<"+t+">":"`"+function(t){try{return JSON.stringify(t)}catch(t){return"<Unserializable: "+t+">"}}(t)+"`"}function W(t){var e=t.value,n=t.context[t.context.length-1].type,r=t.context.map(function(t){return t.path}).filter(function(t){return 0<t.length}).join("/"),i=0<r.length?'at path "/'+r+'" ':"",o=nt(e)?"value of type "+rt(e).type.name+":":_t(e)?"value":"snapshot",a=n&&nt(e)&&n.is(rt(e).snapshot);return""+i+o+" "+$(e)+" is not assignable "+(n?"to type: `"+n.name+"`":"")+(t.message?" ("+t.message+")":"")+(n?se(n)||_t(e)?".":", expected an instance of `"+n.name+"` or a snapshot like `"+n.describe()+"` instead."+(a?" (Note that a snapshot of the provided value is compatible with the targeted type)":""):".")}function G(t,e,n){return t.concat([{path:e,type:n}])}function J(){return ht}function Y(t,e,n){return[{context:t,value:e,message:n}]}function Z(t){return t.reduce(function(t,e){return t.concat(e)},[])}function B(t,e){var n,r,i,o,a=t.validate(e,[{path:"",type:t}]);if(0<a.length)throw dt((n=t,r=e,0!==(i=a).length?"Error while converting "+((o=$(r)).length<280?o:o.substring(0,272)+"......"+o.substring(o.length-8))+" to `"+n.name+"`:\n\n    "+i.map(W).join("\n    "):void 0))}var K,q,Q=0,X=function(){function e(){this.cacheId=Q++,this.cache=c.observable.map(),this.lastCacheModificationPerId=c.observable.map()}return e.prototype.updateLastCacheModificationPerId=function(t){var e=this.lastCacheModificationPerId.get(t);this.lastCacheModificationPerId.set(t,void 0===e?1:e+1)},e.prototype.getLastCacheModificationPerId=function(t){var e=this.lastCacheModificationPerId.get(t)||0;return this.cacheId+"-"+e},e.prototype.addNodeToCache=function(t,e){if(void 0===e&&(e=!0),t.identifierAttribute){var n=t.identifier;this.cache.has(n)||this.cache.set(n,c.observable.array([],lt));var r=this.cache.get(n);if(-1!==r.indexOf(t))throw dt("Already registered");r.push(t),e&&this.updateLastCacheModificationPerId(n)}},e.prototype.mergeCache=function(t){var e=this;c.values(t.identifierCache.cache).forEach(function(t){return t.forEach(function(t){e.addNodeToCache(t)})})},e.prototype.notifyDied=function(t){if(t.identifierAttribute){var e=t.identifier,n=this.cache.get(e);n&&(n.remove(t),n.length||this.cache.delete(e),this.updateLastCacheModificationPerId(t.identifier))}},e.prototype.splitCache=function(t){var o=this,a=new e,s=t.path;return c.entries(this.cache).forEach(function(t){for(var e=t[0],n=t[1],r=!1,i=n.length-1;0<=i;i--)0===n[i].path.indexOf(s)&&(a.addNodeToCache(n[i],!1),n.splice(i,1),r=!0);r&&o.updateLastCacheModificationPerId(e)}),a},e.prototype.has=function(e,t){var n=this.cache.get(t);return!!n&&n.some(function(t){return e.isAssignableFrom(t.type)})},e.prototype.resolve=function(e,t){var n=this.cache.get(t);if(!n)return null;var r=n.filter(function(t){return e.isAssignableFrom(t.type)});switch(r.length){case 0:return null;case 1:return r[0];default:throw dt("Cannot resolve a reference to type '"+e.name+"' with id: '"+t+"' unambigously, there are multiple candidates: "+r.map(function(t){return t.path}).join(", "))}},e}();function tt(t,e,n,r,i){var o=it(i);if(o){if(o.isRoot)return o.setParent(e,n),o;throw dt("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+(e?e.path:"")+"/"+n+"', but it lives already at '"+o.path+"'")}return new C(t,e,n,r,i)}function et(t,e,n,r,i){return new A(t,e,n,r,i)}function nt(t){return!(!t||!t.$treenode)}function rt(t){if(nt(t))return t.$treenode;throw dt("Value "+t+" is no MST Node")}function it(t){return t&&t.$treenode||null}function ot(){return rt(this).snapshot}(q=K||(K={}))[q.INITIALIZING=0]="INITIALIZING",q[q.CREATED=1]="CREATED",q[q.FINALIZED=2]="FINALIZED",q[q.DETACHING=3]="DETACHING",q[q.DEAD=4]="DEAD";var at=function(t){return".."};function st(t,e){if(t.root!==e.root)throw dt("Cannot calculate relative path: objects '"+t+"' and '"+e+"' are not part of the same object tree");for(var n=xt(t.path),r=xt(e.path),i=0;i<n.length&&n[i]===r[i];i++);return n.slice(i).map(at).join("/")+Dt(r.slice(i))}function ut(t,e,n){return void 0===n&&(n=!0),pt(t,xt(e),n)}function pt(t,e,n){void 0===n&&(n=!0);for(var r=t,i=0;i<e.length;i++){var o=e[i];if(".."===o){if(r=r.parent)continue}else{if("."===o)continue;if(r){if(r instanceof A)try{var a=r.value;nt(a)&&(r=rt(a))}catch(t){if(!n)return;throw t}if(r instanceof C)if(r.getChildType(o)&&(r=r.getChildNode(o)))continue}}if(n)throw dt("Could not resolve '"+o+"' in path '"+(Dt(e.slice(0,i))||"/")+"' while resolving '"+Dt(e)+"'");return}return r}function ct(n){if(!n)return ht;var t=Object.keys(n);if(!t.length)return ht;var r=new Array(t.length);return t.forEach(function(t,e){r[e]=n[t]}),r}var ht=Object.freeze([]),ft=Object.freeze({}),lt="string"==typeof c.$mobx?{deep:!1}:{deep:!1,proxy:!1};function dt(t){return void 0===t&&(t="Illegal state"),new Error("[mobx-state-tree] "+t)}function yt(t){return t}Object.freeze(lt);var vt=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function bt(t){return Array.isArray(t)||c.isObservableArray(t)}function gt(t){return t?bt(t)?t:[t]:ht}function mt(t){if(null===t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}function wt(t){return!(null===t||"object"!=typeof t||t instanceof Date||t instanceof RegExp)}function _t(t,e){return void 0===e&&(e=!0),null==t||!!("string"==typeof t||"number"==typeof t||"boolean"==typeof t||e&&t instanceof Date)}function St(t){return t}function Pt(t,e,n){Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!0,value:n})}var At=function(){function t(){this.handlers=[]}return Object.defineProperty(t.prototype,"hasSubscribers",{get:function(){return 0<this.handlers.length},enumerable:!0,configurable:!0}),t.prototype.register=function(t,e){var n=this;return void 0===e&&(e=!1),e?this.handlers.unshift(t):this.handlers.push(t),function(){n.unregister(t)}},t.prototype.has=function(t){return 0<=this.handlers.indexOf(t)},t.prototype.unregister=function(t){var e=this.handlers.indexOf(t);0<=e&&this.handlers.splice(e,1)},t.prototype.clear=function(){this.handlers.length=0},t.prototype.emit=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.slice().forEach(function(t){return t.apply(void 0,e)})},t}(),It=function(){function t(){}return t.prototype.hasSubscribers=function(t){var e=this.eventHandlers&&this.eventHandlers[t];return!!e&&e.hasSubscribers},t.prototype.register=function(t,e,n){void 0===n&&(n=!1),this.eventHandlers||(this.eventHandlers={});var r=this.eventHandlers[t];return r||(r=this.eventHandlers[t]=new At),r.register(e,n)},t.prototype.has=function(t,e){var n=this.eventHandlers&&this.eventHandlers[t];return!!n&&n.has(e)},t.prototype.unregister=function(t,e){var n=this.eventHandlers&&this.eventHandlers[t];n&&n.unregister(e)},t.prototype.clear=function(t){this.eventHandlers&&delete this.eventHandlers[t]},t.prototype.clearAll=function(){this.eventHandlers=void 0},t.prototype.emit=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.eventHandlers&&this.eventHandlers[t];i&&(e=i).emit.apply(e,n)},t}();function Tt(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=t[n];return e}function Ct(t,e){return 0===t.indexOf(e)}var Vt=function(t,e){};function Et(t){console.warn(new Error("[mobx-state-tree] "+t))}function Ot(t){return h=t.name,f=t,l=function(){var s=H(),u=function(){if(!M)throw dt("Not running an action!");return M}(),p=arguments;function c(t,e,n){t.$mst_middleware=l.$mst_middleware,F({name:h,type:e,id:s,args:[n],tree:u.tree,context:u.context,parentId:u.id,allParentIds:u.allParentIds.concat([u.id]),rootId:u.rootId},t)}return new Promise(function(e,n){var r,t=function(){r=f.apply(null,arguments),i(void 0)};function i(t){var e;try{c(function(t){e=r.next(t)},"flow_resume",t)}catch(e){return void setImmediate(function(){c(function(t){n(e)},"flow_throw",e)})}a(e)}function o(t){var e;try{c(function(t){e=r.throw(t)},"flow_resume_error",t)}catch(e){return void setImmediate(function(){c(function(t){n(e)},"flow_throw",e)})}a(e)}function a(t){if(!t.done){if(!t.value||"function"!=typeof t.value.then)throw dt("Only promises can be yielded to `async`, got: "+t);return t.value.then(i,o)}setImmediate(function(){c(function(t){e(t)},"flow_return",t.value)})}t.$mst_middleware=l.$mst_middleware,F({name:h,type:"flow_spawn",id:s,args:Tt(p),tree:u.tree,context:u.context,parentId:u.id,allParentIds:u.allParentIds.concat([u.id]),rootId:u.rootId},t)})};var h,f,l}function Nt(t){return!0==("number"==typeof t)?""+t:-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function jt(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Dt(t){if(0===t.length)return"";var e=function(t){return t.map(Nt).join("/")};return"."===t[0]||".."===t[0]?e(t):"/"+e(t)}function xt(t){var e=t.split("/").map(jt);if(!(""===t||"."===t||".."===t||Ct(t,"/")||Ct(t,"./")||Ct(t,"../")))throw dt("a json path must be either rooted, empty or relative, but got '"+t+"'");return""===e[0]&&e.shift(),e}Vt.ids={};var Rt=function(i){function t(t,e,n){var r=i.call(this,n||t.name)||this;return r._subtype=t,r._processors=e,r}return s(t,i),Object.defineProperty(t.prototype,"flags",{get:function(){return this._subtype.flags|_.SnapshotProcessor},enumerable:!0,configurable:!0}),t.prototype.describe=function(){return"snapshotProcessor("+this._subtype.describe()+")"},t.prototype.preProcessSnapshot=function(t){return this._processors.preProcessor?this._processors.preProcessor.call(null,t):t},t.prototype.postProcessSnapshot=function(t){return this._processors.postProcessor?this._processors.postProcessor.call(null,t):t},t.prototype._fixNode=function(t){var e=this;!function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];t[a]=e[a].bind(e)}}(t.type,this,"isAssignableFrom","create");var n=t.getSnapshot;t.getSnapshot=function(){return e.postProcessSnapshot(n.call(t))}},t.prototype.instantiate=function(t,e,n,r){var i=nt(r)?r:this.preProcessSnapshot(r),o=this._subtype.instantiate(t,e,n,i);return this._fixNode(o),o},t.prototype.reconcile=function(t,e){var n=this._subtype.reconcile(t,nt(e)?e:this.preProcessSnapshot(e));return n!==t&&this._fixNode(n),n},t.prototype.getSnapshot=function(t,e){void 0===e&&(e=!0);var n=this._subtype.getSnapshot(t);return e?this.postProcessSnapshot(n):n},t.prototype.isValidSnapshot=function(t,e){var n=this.preProcessSnapshot(t);return this._subtype.validate(n,e)},t.prototype.getSubTypes=function(){return this._subtype},t}(E);var kt,zt,Mt="Map.put can only be used to store complex values that have an identifier type attribute";(zt=kt||(kt={}))[zt.UNKNOWN=0]="UNKNOWN",zt[zt.YES=1]="YES",zt[zt.NO=2]="NO";var Ht=function(n){function t(t){return n.call(this,t,c.observable.ref.enhancer)||this}return s(t,n),t.prototype.get=function(t){return n.prototype.get.call(this,""+t)},t.prototype.has=function(t){return n.prototype.has.call(this,""+t)},t.prototype.delete=function(t){return n.prototype.delete.call(this,""+t)},t.prototype.set=function(t,e){return n.prototype.set.call(this,""+t,e)},t.prototype.put=function(t){if(!t)throw dt("Map.put cannot be used to set empty values");if(nt(t)){var e=rt(t);return this.set(e.identifier,t),t}if(wt(t)){var n=rt(this).type;if(n.identifierMode===kt.NO)throw dt(Mt);if(n.identifierMode!==kt.YES)throw dt(Mt);var r=De(t[n.mapIdentifierAttribute]);return this.set(r,t),this.get(r)}throw dt("Map.put can only be used to store complex values")},t}(c.ObservableMap),Ft=function(r){function t(t,e){var n=r.call(this,t)||this;return n._subType=e,n.identifierMode=kt.UNKNOWN,n.mapIdentifierAttribute=void 0,n.flags=_.Map,n._determineIdentifierMode(),n}return s(t,r),t.prototype.instantiate=function(t,e,n,r){return this._determineIdentifierMode(),tt(this,t,e,n,r)},t.prototype._determineIdentifierMode=function(){if(this.identifierMode===kt.UNKNOWN){var t=[];if(function t(e,n){var r=e.getSubTypes();if(r===V)return!1;if(r)for(var i=0,o=gt(r);i<o.length;i++)if(!t(o[i],n))return!1;return e instanceof Kt&&n.push(e),!0}(this._subType,t)){var e=void 0;t.forEach(function(t){if(t.identifierAttribute){if(e&&e!==t.identifierAttribute)throw dt("The objects in a map should all have the same identifier attribute, expected '"+e+"', but child of type '"+t.name+"' declared attribute '"+t.identifierAttribute+"' as identifier");e=t.identifierAttribute}}),e?(this.identifierMode=kt.YES,this.mapIdentifierAttribute=e):this.identifierMode=kt.NO}}},t.prototype.initializeChildNodes=function(e,n){void 0===n&&(n={});var r=e.type._subType,i=e.environment,o={};return Object.keys(n).forEach(function(t){o[t]=r.instantiate(e,t,i,n[t])}),o},t.prototype.createNewInstance=function(t,e){return new Ht(e)},t.prototype.finalizeNewInstance=function(t,e){c._interceptReads(e,t.unbox),c.intercept(e,this.willChange),c.observe(e,this.didChange)},t.prototype.describe=function(){return"Map<string, "+this._subType.describe()+">"},t.prototype.getChildren=function(t){return c.values(t.storedValue)},t.prototype.getChildNode=function(t,e){var n=t.storedValue.get(""+e);if(!n)throw dt("Not a child "+e);return n},t.prototype.willChange=function(t){var e=rt(t.object),n=t.name;e.assertWritable({subpath:n});var r=e.type,i=r._subType;switch(t.type){case"update":var o=t.newValue;if(o===t.object.get(n))return null;t.newValue=i.reconcile(e.getChildNode(n),t.newValue),r.processIdentifier(n,t.newValue);break;case"add":t.newValue,t.newValue=i.instantiate(e,n,void 0,t.newValue),r.processIdentifier(n,t.newValue)}return t},t.prototype.processIdentifier=function(t,e){if(this.identifierMode===kt.YES&&e instanceof C){var n=e.identifier;if(n!==t)throw dt("A map of objects containing an identifier should always store the object under their own identifier. Trying to store key '"+n+"', but expected: '"+t+"'")}},t.prototype.getSnapshot=function(t){var e={};return t.getChildren().forEach(function(t){e[t.subpath]=t.snapshot}),e},t.prototype.processInitialSnapshot=function(e){var n={};return Object.keys(e).forEach(function(t){n[t]=e[t].getSnapshot()}),n},t.prototype.didChange=function(t){var e=rt(t.object);switch(t.type){case"update":return void e.emitPatch({op:"replace",path:Nt(t.name),value:t.newValue.snapshot,oldValue:t.oldValue?t.oldValue.snapshot:void 0},e);case"add":return void e.emitPatch({op:"add",path:Nt(t.name),value:t.newValue.snapshot,oldValue:void 0},e);case"delete":var n=t.oldValue.snapshot;return t.oldValue.die(),void e.emitPatch({op:"remove",path:Nt(t.name),oldValue:n},e)}},t.prototype.applyPatchLocally=function(t,e,n){var r=t.storedValue;switch(n.op){case"add":case"replace":r.set(e,n.value);break;case"remove":r.delete(e)}},t.prototype.applySnapshot=function(t,e){var n=t.storedValue,r={};if(Array.from(n.keys()).forEach(function(t){r[t]=!1}),e)for(var i in e)n.set(i,e[i]),r[""+i]=!0;Object.keys(r).forEach(function(t){!1===r[t]&&n.delete(t)})},t.prototype.getChildType=function(){return this._subType},t.prototype.isValidSnapshot=function(e,n){var r=this;return mt(e)?Z(Object.keys(e).map(function(t){return r._subType.validate(e[t],G(n,t,r._subType))})):Y(n,e,"Value is not a plain object")},t.prototype.getDefaultSnapshot=function(){return ft},t.prototype.removeChild=function(t,e){t.storedValue.delete(e)},p([c.action],t.prototype,"applySnapshot",null),t}(O);var Lt=function(r){function t(t,e){var n=r.call(this,t)||this;return n._subType=e,n.flags=_.Array,n}return s(t,r),t.prototype.instantiate=function(t,e,n,r){return tt(this,t,e,n,r)},t.prototype.initializeChildNodes=function(r,t){void 0===t&&(t=[]);var i=r.type._subType,o=r.environment,a={};return t.forEach(function(t,e){var n=""+e;a[n]=i.instantiate(r,n,o,t)}),a},t.prototype.createNewInstance=function(t,e){return c.observable.array(ct(e),lt)},t.prototype.finalizeNewInstance=function(t,e){c._getAdministration(e).dehancer=t.unbox,c.intercept(e,this.willChange),c.observe(e,this.didChange)},t.prototype.describe=function(){return this._subType.describe()+"[]"},t.prototype.getChildren=function(t){return t.storedValue.slice()},t.prototype.getChildNode=function(t,e){var n=parseInt(e,10);if(n<t.storedValue.length)return t.storedValue[n];throw dt("Not a child: "+e)},t.prototype.willChange=function(t){var e=rt(t.object);e.assertWritable({subpath:String(t.index)});var n=e.type._subType,r=e.getChildren(),i=null;switch(t.type){case"update":if(t.newValue===t.object[t.index])return null;if(!(i=Ut(e,n,[r[t.index]],[t.newValue],[t.index])))return null;t.newValue=i[0];break;case"splice":var o=t.index,a=t.removedCount,s=t.added;if(!(i=Ut(e,n,r.slice(o,o+a),s,s.map(function(t,e){return o+e}))))return null;t.added=i;for(var u=o+a;u<r.length;u++)r[u].setParent(e,""+(u+s.length-a))}return t},t.prototype.getSnapshot=function(t){return t.getChildren().map(function(t){return t.snapshot})},t.prototype.processInitialSnapshot=function(e){var n=[];return Object.keys(e).forEach(function(t){n.push(e[t].getSnapshot())}),n},t.prototype.didChange=function(t){var e=rt(t.object);switch(t.type){case"update":return void e.emitPatch({op:"replace",path:""+t.index,value:t.newValue.snapshot,oldValue:t.oldValue?t.oldValue.snapshot:void 0},e);case"splice":for(var n=t.removedCount-1;0<=n;n--)e.emitPatch({op:"remove",path:""+(t.index+n),oldValue:t.removed[n].snapshot},e);for(n=0;n<t.addedCount;n++)e.emitPatch({op:"add",path:""+(t.index+n),value:e.getChildNode(""+(t.index+n)).snapshot,oldValue:void 0},e);return}},t.prototype.applyPatchLocally=function(t,e,n){var r=t.storedValue,i="-"===e?r.length:parseInt(e);switch(n.op){case"replace":r[i]=n.value;break;case"add":r.splice(i,0,n.value);break;case"remove":r.splice(i,1)}},t.prototype.applySnapshot=function(t,e){t.storedValue.replace(e)},t.prototype.getChildType=function(){return this._subType},t.prototype.isValidSnapshot=function(t,n){var r=this;return bt(t)?Z(t.map(function(t,e){return r._subType.validate(t,G(n,""+e,r._subType))})):Y(n,t,"Value is not an array")},t.prototype.getDefaultSnapshot=function(){return ht},t.prototype.removeChild=function(t,e){t.storedValue.splice(parseInt(e,10),1)},p([c.action],t.prototype,"applySnapshot",null),t}(O);function Ut(t,e,n,r,i){for(var o,a=!0,s=0;;s++){var u=s<=r.length-1,p=n[s],c=u?r[s]:void 0,h=""+i[s];if(((o=c)instanceof A||o instanceof C)&&(c=c.storedValue),!p&&!u)break;if(u)if(p)if(Wt(p,c))n[s]=$t(e,t,h,c,p);else{for(var f=void 0,l=s;l<n.length;l++)if(Wt(n[l],c)){f=n.splice(l,1)[0];break}n.splice(s,0,$t(e,t,h,c,f)),a=!1}else{if(nt(c)&&rt(c).parent===t)throw dt("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+t.path+"/"+h+"', but it lives already at '"+rt(c).path+"'");n.splice(s,0,$t(e,t,h,c)),a=!1}else p.die(),n.splice(s,1),s--,a=!1}return a?null:n}function $t(t,e,n,r,i){var o;if(nt(r)&&((o=rt(r)).assertAlive(ft),null!==o.parent&&o.parent===e))return o.setParent(e,n),i&&i!==o&&i.die(),o;return i?((o=t.reconcile(i,r)).setParent(e,n),o!==i&&i.die(),o):t.instantiate(e,n,e.environment,r)}function Wt(t,e){if(!t.isAlive)return!1;if(nt(e)){var n=rt(e);return n.isAlive&&n===t}return t.snapshot===e||t instanceof C&&null!==t.identifier&&t.identifierAttribute&&mt(e)&&t.identifier===De(e[t.identifierAttribute])&&t.type.is(e)}var Gt="preProcessSnapshot",Jt="postProcessSnapshot";function Yt(){return rt(this).toString()}var Zt={name:"AnonymousModel",properties:{},initializers:ht};function Bt(t){return Object.keys(t).reduce(function(t,e){var n,r,i;if(e in h)throw dt("Hook '"+e+"' was defined as property. Hooks should be defined as part of the actions");var o=Object.getOwnPropertyDescriptor(t,e);if("get"in o)throw dt("Getters are not supported as properties. Please use views instead");var a=o.value;if(null==a)throw dt("The default value of an attribute cannot be null or undefined as the type cannot be inferred. Did you mean `types.maybe(someType)`?");if(_t(a))return Object.assign({},t,((n={})[e]=de(function(t){switch(typeof t){case"string":return Xt;case"number":return te;case"boolean":return ne;case"object":if(t instanceof Date)return ae}throw dt("Cannot determine primitive type from value "+t)}(a),a),n));if(a instanceof Ft)return Object.assign({},t,((r={})[e]=de(a,{}),r));if(a instanceof Lt)return Object.assign({},t,((i={})[e]=de(a,[]),i));if(j(a))return t;throw dt("Invalid type definition for property '"+e+"', cannot infer a type from a value like '"+a+"' ("+typeof a+")")},t)}var Kt=function(n){function e(t){var u=n.call(this,t.name||Zt.name)||this;u.flags=_.Object,u.actions=function(e){return u.cloneAndEnhance({initializers:[function(t){return u.instantiateActions(t,e(t)),t}]})},u.named=function(t){return u.cloneAndEnhance({name:t})},u.props=function(t){return u.cloneAndEnhance({properties:t})},u.volatile=function(e){return u.cloneAndEnhance({initializers:[function(t){return u.instantiateVolatileState(t,e(t)),t}]})},u.extend=function(s){return u.cloneAndEnhance({initializers:[function(t){var e=s(t),n=e.actions,r=e.views,i=e.state,o=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]])}return n}(e,["actions","views","state"]);for(var a in o)throw dt("The `extend` function should return an object with a subset of the fields 'actions', 'views' and 'state'. Found invalid key '"+a+"'");return i&&u.instantiateVolatileState(t,i),r&&u.instantiateViews(t,r),n&&u.instantiateActions(t,n),t}]})},u.views=function(e){return u.cloneAndEnhance({initializers:[function(t){return u.instantiateViews(t,e(t)),t}]})},u.preProcessSnapshot=function(e){var n=u.preProcessor;return n?u.cloneAndEnhance({preProcessor:function(t){return n(e(t))}}):u.cloneAndEnhance({preProcessor:e})},u.postProcessSnapshot=function(e){var n=u.postProcessor;return n?u.cloneAndEnhance({postProcessor:function(t){return e(n(t))}}):u.cloneAndEnhance({postProcessor:e})};var e=t.name||Zt.name;if(!/^\w[\w\d_]*$/.test(e))throw dt("Typename should be a valid identifier: "+e);return Object.assign(u,Zt,t),u.properties=Bt(u.properties),St(u.properties),u.propertyNames=Object.keys(u.properties),u.identifierAttribute=u._getIdentifierAttribute(),u}return s(e,n),e.prototype._getIdentifierAttribute=function(){var n=void 0;return this.forAllProps(function(t,e){if(e.flags&_.Identifier){if(n)throw dt("Cannot define property '"+t+"' as object identifier, property '"+n+"' is already defined as identifier property");n=t}}),n},e.prototype.cloneAndEnhance=function(t){return new e({name:t.name||this.name,properties:Object.assign({},this.properties,t.properties),initializers:this.initializers.concat(t.initializers||[]),preProcessor:t.preProcessor||this.preProcessor,postProcessor:t.postProcessor||this.postProcessor})},e.prototype.instantiateActions=function(s,u){if(!mt(u))throw dt("actions initializer should return a plain object containing actions");Object.keys(u).forEach(function(t){if(t===Gt)throw dt("Cannot define action '"+Gt+"', it should be defined using 'type.preProcessSnapshot(fn)' instead");if(t===Jt)throw dt("Cannot define action '"+Jt+"', it should be defined using 'type.postProcessSnapshot(fn)' instead");var e=u[t],n=s[t];if(t in h&&n){var r=e;e=function(){n.apply(null,arguments),r.apply(null,arguments)}}var i=e.$mst_middleware,o=e.bind(u);o.$mst_middleware=i;var a=L(s,t,o);u[t]=a,Pt(s,t,a)})},e.prototype.instantiateVolatileState=function(t,e){if(!mt(e))throw dt("volatile state initializer should return a plain object containing state");c.set(t,e)},e.prototype.instantiateViews=function(i,o){if(!mt(o))throw dt("views initializer should return a plain object containing views");Object.keys(o).forEach(function(t){var e=Object.getOwnPropertyDescriptor(o,t),n=e.value;if("get"in e)if(c.isComputedProp(i,t)){var r=c._getAdministration(i,t);r.derivation=e.get,r.scope=i,e.set&&(r.setter=c.action(r.name+"-setter",e.set))}else c.computed(i,t,e,!0);else{if("function"!=typeof n)throw dt("A view member should either be a function or getter based property");Pt(i,t,n)}})},e.prototype.instantiate=function(t,e,n,r){return tt(this,t,e,n,nt(r)?r:this.applySnapshotPreProcessor(r))},e.prototype.initializeChildNodes=function(n,r){void 0===r&&(r={});var t=n.type,i={};return t.forAllProps(function(t,e){i[t]=e.instantiate(n,t,n.environment,r[t])}),i},e.prototype.createNewInstance=function(t,e){return c.observable.object(e,ft,lt)},e.prototype.finalizeNewInstance=function(e,n){Pt(n,"toString",Yt),this.forAllProps(function(t){c._interceptReads(n,t,e.unbox)}),this.initializers.reduce(function(t,e){return e(t)},n),c.intercept(n,this.willChange),c.observe(n,this.didChange)},e.prototype.willChange=function(t){var e=t,n=rt(e.object);n.assertWritable({subpath:e.name});var r=n.type.properties[e.name];return r&&(e.newValue,e.newValue=r.reconcile(n.getChildNode(e.name),e.newValue)),e},e.prototype.didChange=function(t){var e=t,n=rt(e.object);if(n.type.properties[e.name]){var r=e.oldValue?e.oldValue.snapshot:void 0;n.emitPatch({op:"replace",path:Nt(e.name),value:e.newValue.snapshot,oldValue:r},n)}},e.prototype.getChildren=function(e){var n=this,r=[];return this.forAllProps(function(t){r.push(n.getChildNode(e,t))}),r},e.prototype.getChildNode=function(t,e){if(!(e in this.properties))throw dt("Not a value property: "+e);var n=c._getAdministration(t.storedValue,e).value;if(!n)throw dt("Node not available for property "+e);return n},e.prototype.getSnapshot=function(n,t){var r=this;void 0===t&&(t=!0);var i={};return this.forAllProps(function(t,e){c.getAtom(n.storedValue,t).reportObserved(),i[t]=r.getChildNode(n,t).snapshot}),t?this.applySnapshotPostProcessor(i):i},e.prototype.processInitialSnapshot=function(e){var n={};return Object.keys(e).forEach(function(t){n[t]=e[t].getSnapshot()}),this.applySnapshotPostProcessor(n)},e.prototype.applyPatchLocally=function(t,e,n){if("replace"!==n.op&&"add"!==n.op)throw dt("object does not support operation "+n.op);t.storedValue[e]=n.value},e.prototype.applySnapshot=function(e,t){var n=this.applySnapshotPreProcessor(t);this.forAllProps(function(t){e.storedValue[t]=n[t]})},e.prototype.applySnapshotPreProcessor=function(t){var e=this.preProcessor;return e?e.call(null,t):t},e.prototype.applySnapshotPostProcessor=function(t){var e=this.postProcessor;return e?e.call(null,t):t},e.prototype.getChildType=function(t){return this.properties[t]},e.prototype.isValidSnapshot=function(t,e){var n=this,r=this.applySnapshotPreProcessor(t);return mt(r)?Z(this.propertyNames.map(function(t){return n.properties[t].validate(r[t],G(e,t,n.properties[t]))})):Y(e,r,"Value is not a plain object")},e.prototype.forAllProps=function(e){var n=this;this.propertyNames.forEach(function(t){return e(t,n.properties[t])})},e.prototype.describe=function(){var e=this;return"{ "+this.propertyNames.map(function(t){return t+": "+e.properties[t].describe()}).join("; ")+" }"},e.prototype.getDefaultSnapshot=function(){return ft},e.prototype.removeChild=function(t,e){t.storedValue[e]=void 0},p([c.action],e.prototype,"applySnapshot",null),e}(O);function qt(t){return j(t)&&0<(t.flags&_.Object)}var Qt=function(o){function t(t,e,n,r){void 0===r&&(r=yt);var i=o.call(this,t)||this;return i.flags=e,i.checker=n,i.initializer=r,i.flags=e,i}return s(t,o),t.prototype.describe=function(){return this.name},t.prototype.instantiate=function(t,e,n,r){return et(this,t,e,n,r)},t.prototype.createNewInstance=function(t){return this.initializer(t)},t.prototype.isValidSnapshot=function(t,e){return _t(t)&&this.checker(t)?J():Y(e,t,"Value is not a "+("Date"===this.name?"Date or a unix milliseconds timestamp":this.name))},t}(N),Xt=new Qt("string",_.String,function(t){return"string"==typeof t}),te=new Qt("number",_.Number,function(t){return"number"==typeof t}),ee=new Qt("integer",_.Integer,function(t){return vt(t)}),ne=new Qt("boolean",_.Boolean,function(t){return"boolean"==typeof t}),re=new Qt("null",_.Null,function(t){return null===t}),ie=new Qt("undefined",_.Undefined,function(t){return void 0===t}),oe=new Qt("Date",_.Date,function(t){return"number"==typeof t||t instanceof Date},function(t){return t instanceof Date?t:new Date(t)});oe.getSnapshot=function(t){return t.storedValue.getTime()};var ae=oe;function se(t){return j(t)&&0<(t.flags&(_.String|_.Number|_.Integer|_.Boolean|_.Date))}var ue=function(n){function t(t){var e=n.call(this,JSON.stringify(t))||this;return e.flags=_.Literal,e.value=t,e}return s(t,n),t.prototype.instantiate=function(t,e,n,r){return et(this,t,e,n,r)},t.prototype.describe=function(){return JSON.stringify(this.value)},t.prototype.isValidSnapshot=function(t,e){return _t(t)&&t===this.value?J():Y(e,t,"Value is not a literal "+JSON.stringify(this.value))},t}(N);function pe(t){return new ue(t)}var ce=function(o){function t(t,e,n,r){var i=o.call(this,t)||this;return i._subtype=e,i._predicate=n,i._message=r,i}return s(t,o),Object.defineProperty(t.prototype,"flags",{get:function(){return this._subtype.flags|_.Refinement},enumerable:!0,configurable:!0}),t.prototype.describe=function(){return this.name},t.prototype.instantiate=function(t,e,n,r){return this._subtype.instantiate(t,e,n,r)},t.prototype.isAssignableFrom=function(t){return this._subtype.isAssignableFrom(t)},t.prototype.isValidSnapshot=function(t,e){var n=this._subtype.validate(t,e);if(0<n.length)return n;var r=nt(t)?rt(t).snapshot:t;return this._predicate(r)?J():Y(e,t,this._message(t))},t.prototype.reconcile=function(t,e){return this._subtype.reconcile(t,e)},t.prototype.getSubTypes=function(){return this._subtype},t}(E);var he=function(i){function t(t,e,n){var r=i.call(this,t)||this;return r._types=e,r._eager=!0,n=a({eager:!0,dispatcher:void 0},n),r._dispatcher=n.dispatcher,n.eager||(r._eager=!1),r}return s(t,i),Object.defineProperty(t.prototype,"flags",{get:function(){var e=_.Union;return this._types.forEach(function(t){e|=t.flags}),e},enumerable:!0,configurable:!0}),t.prototype.isAssignableFrom=function(e){return this._types.some(function(t){return t.isAssignableFrom(e)})},t.prototype.describe=function(){return"("+this._types.map(function(t){return t.describe()}).join(" | ")+")"},t.prototype.instantiate=function(t,e,n,r){var i=this.determineType(r,void 0);if(!i)throw dt("No matching type for union "+this.describe());return i.instantiate(t,e,n,r)},t.prototype.reconcile=function(t,e){var n=this.determineType(e,t.type);if(!n)throw dt("No matching type for union "+this.describe());return n.reconcile(t,e)},t.prototype.determineType=function(e,n){return this._dispatcher?this._dispatcher(e):n?n.is(e)?n:this._types.filter(function(t){return t!==n}).find(function(t){return t.is(e)}):this._types.find(function(t){return t.is(e)})},t.prototype.isValidSnapshot=function(t,e){if(this._dispatcher)return this._dispatcher(t).validate(t,e);for(var n=[],r=0,i=0;i<this._types.length;i++){var o=this._types[i].validate(t,e);if(0===o.length){if(this._eager)return J();r++}else n.push(o)}return 1===r?J():Y(e,t,"No type is applicable for the union").concat(Z(n))},t.prototype.getSubTypes=function(){return this._types},t}(E);function fe(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=j(t)?void 0:t,i=j(t)?[t].concat(e):e,o="("+i.map(function(t){return t.name}).join(" | ")+")";return new he(o,i,r)}var le=function(i){function t(t,e,n){var r=i.call(this,t.name)||this;return r._subtype=t,r._defaultValue=e,r.optionalValues=n,r}return s(t,i),Object.defineProperty(t.prototype,"flags",{get:function(){return this._subtype.flags|_.Optional},enumerable:!0,configurable:!0}),t.prototype.describe=function(){return this._subtype.describe()+"?"},t.prototype.instantiate=function(t,e,n,r){if(0<=this.optionalValues.indexOf(r)){var i=this.getDefaultInstanceOrSnapshot();return this._subtype.instantiate(t,e,n,i)}return this._subtype.instantiate(t,e,n,r)},t.prototype.reconcile=function(t,e){return this._subtype.reconcile(t,this.optionalValues.indexOf(e)<0&&this._subtype.is(e)?e:this.getDefaultInstanceOrSnapshot())},t.prototype.getDefaultInstanceOrSnapshot=function(){var t="function"==typeof this._defaultValue?this._defaultValue():this._defaultValue;return this._defaultValue,t},t.prototype.isValidSnapshot=function(t,e){return 0<=this.optionalValues.indexOf(t)?J():this._subtype.validate(t,e)},t.prototype.isAssignableFrom=function(t){return this._subtype.isAssignableFrom(t)},t.prototype.getSubTypes=function(){return this._subtype},t}(E);function de(t,e,n){return function(t,e){if("function"!=typeof e&&nt(e))throw dt("default value cannot be an instance, pass a snapshot or a function that creates an instance/snapshot instead")}(0,e),new le(t,e,n||ye)}var ye=[void 0];var ve=de(ie,void 0),be=de(re,null);function ge(t){return fe(t,ve)}var me=function(r){function t(t,e){var n=r.call(this,t)||this;return n._definition=e,n}return s(t,r),Object.defineProperty(t.prototype,"flags",{get:function(){return(this._subType?this._subType.flags:0)|_.Late},enumerable:!0,configurable:!0}),t.prototype.getSubType=function(t){if(!this._subType){var e=void 0;try{e=this._definition()}catch(t){if(!(t instanceof ReferenceError))throw t;e=void 0}if(t&&void 0===e)throw dt("Late type seems to be used too early, the definition (still) returns undefined");e&&(this._subType=e)}return this._subType},t.prototype.instantiate=function(t,e,n,r){return this.getSubType(!0).instantiate(t,e,n,r)},t.prototype.reconcile=function(t,e){return this.getSubType(!0).reconcile(t,e)},t.prototype.describe=function(){var t=this.getSubType(!1);return t?t.name:"<uknown late type>"},t.prototype.isValidSnapshot=function(t,e){var n=this.getSubType(!1);return n?n.validate(t,e):J()},t.prototype.isAssignableFrom=function(t){var e=this.getSubType(!1);return!!e&&e.isAssignableFrom(t)},t.prototype.getSubTypes=function(){var t=this.getSubType(!1);return t||V},t}(E);var we=function(n){function t(t){var e=n.call(this,t?"frozen("+t.name+")":"frozen")||this;return e.subType=t,e.flags=_.Frozen,e}return s(t,n),t.prototype.describe=function(){return"<any immutable value>"},t.prototype.instantiate=function(t,e,n,r){return et(this,t,e,n,r)},t.prototype.isValidSnapshot=function(t,e){return"function"==typeof t?Y(e,t,"Value is not serializable and cannot be frozen"):this.subType?this.subType.validate(t,e):J()},t}(N),_e=new we;var Se=function(){function t(t,e){if(this.targetType=e,"string"==typeof t||"number"==typeof t)this.identifier=t;else{if(!nt(t))throw dt("Can only store references to tree nodes or identifiers, got: '"+t+"'");var n=rt(t);if(!n.identifierAttribute)throw dt("Can only store references with a defined identifier attribute.");var r=n.unnormalizedIdentifier;if(null==r)throw dt("Can only store references to tree nodes with a defined identifier.");this.identifier=r}}return t.prototype.updateResolvedReference=function(t){var e=De(this.identifier),n=t.root,r=n.identifierCache.getLastCacheModificationPerId(e);if(!this.resolvedReference||this.resolvedReference.lastCacheModification!==r){var i=this.targetType,o=n.identifierCache.resolve(i,e);if(!o)throw new Pe("[mobx-state-tree] Failed to resolve reference '"+this.identifier+"' to type '"+this.targetType.name+"' (from node: "+t.path+")");this.resolvedReference={node:o,lastCacheModification:r}}},Object.defineProperty(t.prototype,"resolvedValue",{get:function(){return this.updateResolvedReference(this.node),this.resolvedReference.node.value},enumerable:!0,configurable:!0}),t}(),Pe=function(n){function r(t){var e=n.call(this,t)||this;return Object.setPrototypeOf(e,r.prototype),e}return s(r,n),r}(Error),Ae=function(r){function t(t,e){var n=r.call(this,"reference("+t.name+")")||this;return n.targetType=t,n.onInvalidated=e,n.flags=_.Reference,n}return s(t,r),t.prototype.describe=function(){return this.name},t.prototype.isAssignableFrom=function(t){return this.targetType.isAssignableFrom(t)},t.prototype.isValidSnapshot=function(t,e){return"string"==typeof t||"number"==typeof t?J():Y(e,t,"Value is not a valid identifier, which is a string or a number")},t.prototype.fireInvalidated=function(t,e,n,r){var i=e.parent;if(i&&i.isAlive){var o=i.storedValue;o&&this.onInvalidated({cause:t,parent:o,invalidTarget:r?r.storedValue:void 0,invalidId:n,replaceRef:function(t){l(e.root.storedValue,{op:"replace",value:t,path:e.path})},removeRef:function(){qt(i.type)?this.replaceRef(void 0):l(e.root.storedValue,{op:"remove",path:e.path})}})}},t.prototype.addTargetNodeWatcher=function(r,i){var o=this,t=this.getValue(r);if(t){var a=rt(t),e=function(t,e){var n=function(t){switch(t){case h.beforeDestroy:return"destroy";case h.beforeDetach:return"detach";default:return}}(e);n&&o.fireInvalidated(n,r,i,a)},n=a.registerHook(h.beforeDetach,e),s=a.registerHook(h.beforeDestroy,e);return function(){n(),s()}}},t.prototype.watchTargetNodeForInvalidations=function(r,i,o){var a=this;if(this.onInvalidated){var s;r.registerHook(h.beforeDestroy,function(){s&&s()});var t=function(t){s&&s();var e=r.parent,n=e&&e.storedValue;if(e&&e.isAlive&&n){(o?!!o.get(i,n):r.root.identifierCache.has(a.targetType,De(i)))?s=a.addTargetNodeWatcher(r,i):t||a.fireInvalidated("invalidSnapshotReference",r,i,null)}};r.state===K.FINALIZED?t(!0):(r.isRoot||r.root.registerHook(h.afterCreationFinalization,function(){r.parent&&r.parent.createObservableInstanceIfNeeded()}),r.registerHook(h.afterAttach,function(){t(!1)}))}},t}(N),Ie=function(n){function t(t,e){return n.call(this,t,e)||this}return s(t,n),t.prototype.getValue=function(t){if(t.isAlive)return t.storedValue.resolvedValue},t.prototype.getSnapshot=function(t){return t.storedValue.identifier},t.prototype.instantiate=function(t,e,n,r){var i=nt(r)?b(r):r,o=new Se(r,this.targetType),a=et(this,t,e,n,o);return o.node=a,this.watchTargetNodeForInvalidations(a,i,void 0),a},t.prototype.reconcile=function(t,e){if(!t.isDetaching&&t.type===this){var n=nt(e),r=t.storedValue;if(!n&&r.identifier===e)return t;if(n&&r.resolvedValue===e)return t}var i=this.instantiate(t.parent,t.subpath,t.environment,e);return t.die(),i},t}(Ae),Te=function(i){function t(t,e,n){var r=i.call(this,t,n)||this;return r.options=e,r}return s(t,i),t.prototype.getValue=function(t){if(t.isAlive)return this.options.get(t.storedValue,t.parent?t.parent.storedValue:null)},t.prototype.getSnapshot=function(t){return t.storedValue},t.prototype.instantiate=function(t,e,n,r){var i=nt(r)?this.options.set(r,t?t.storedValue:null):r,o=et(this,t,e,n,i);return this.watchTargetNodeForInvalidations(o,i,this.options),o},t.prototype.reconcile=function(t,e){var n=nt(e)?this.options.set(e,t?t.storedValue:null):e;if(!t.isDetaching&&t.type===this&&t.storedValue===n)return t;var r=this.instantiate(t.parent,t.subpath,t.environment,n);return t.die(),r},t}(Ae);function Ce(t,e){var n=e||void 0,r=e?e.onInvalidated:void 0;return n&&(n.get||n.set)?new Te(t,{get:n.get,set:n.set},r):new Ie(t,r)}var Ve=function(r){function t(t,e){var n=r.call(this,t)||this;return n.validType=e,n.flags=_.Identifier,n}return s(t,r),t.prototype.instantiate=function(t,e,n,r){if(!(t&&t.type instanceof Kt))throw dt("Identifier types can only be instantiated as direct child of a model type");return et(this,t,e,n,r)},t.prototype.reconcile=function(t,e){if(t.storedValue!==e)throw dt("Tried to change identifier from '"+t.storedValue+"' to '"+e+"'. Changing identifiers is not allowed.");return t},t.prototype.isValidSnapshot=function(t,e){return typeof t!==this.validType?Y(e,t,"Value is not a valid "+this.describe()+", expected a "+this.validType):J()},t}(N),Ee=function(e){function t(){var t=e.call(this,"identifier","string")||this;return t.flags=_.Identifier,t}return s(t,e),t.prototype.describe=function(){return"identifier"},t}(Ve),Oe=function(t){function e(){return t.call(this,"identifierNumber","number")||this}return s(e,t),e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.describe=function(){return"identifierNumber"},e}(Ve),Ne=new Ee,je=new Oe;function De(t){return""+t}var xe=function(n){function t(t){var e=n.call(this,t.name)||this;return e.options=t,e.flags=_.Custom,e}return s(t,n),t.prototype.describe=function(){return this.name},t.prototype.isValidSnapshot=function(t,e){if(this.options.isTargetType(t))return J();var n=this.options.getValidationMessage(t);return n?Y(e,t,"Invalid value for type '"+this.name+"': "+n):J()},t.prototype.getSnapshot=function(t){return this.options.toSnapshot(t.storedValue)},t.prototype.instantiate=function(t,e,n,r){return et(this,t,e,n,this.options.isTargetType(r)?r:this.options.fromSnapshot(r))},t.prototype.reconcile=function(t,e){var n=!this.options.isTargetType(e);if(!t.isDetaching&&(t.type===this&&(n?e===t.snapshot:e===t.storedValue)))return t;var r=n?this.options.fromSnapshot(e):e,i=this.instantiate(t.parent,t.subpath,t.environment,r);return t.die(),i},t}(N),Re={enumeration:function(t,e){var n=fe.apply(void 0,("string"==typeof t?e:t).map(function(t){return pe(""+t)}));return"string"==typeof t&&(n.name=t),n},model:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0]?t.shift():"AnonymousModel",r=t.shift()||{};return new Kt({name:n,properties:r})},compose:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0]?t.shift():"AnonymousModel";return t.reduce(function(e,n){return e.cloneAndEnhance({name:e.name+"_"+n.name,properties:n.properties,initializers:n.initializers,preProcessor:function(t){return n.applySnapshotPreProcessor(e.applySnapshotPreProcessor(t))},postProcessor:function(t){return n.applySnapshotPostProcessor(e.applySnapshotPostProcessor(t))}})}).named(n)},custom:function(t){return new xe(t)},reference:Ce,safeReference:function(t,e){return ge(Ce(t,a({},e,{onInvalidated:function(t){t.removeRef()}})))},union:fe,optional:de,literal:pe,maybe:ge,maybeNull:function(t){return fe(t,be)},refinement:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0]?t.shift():j(t[0])?t[0].name:null,r=t[0],i=t[1],o=t[2]?t[2]:function(t){return"Value does not respect the refinement predicate"};return new ce(n,r,i,o)},string:Xt,boolean:ne,number:te,integer:ee,Date:ae,map:function(t){return new Ft("map<string, "+t.name+">",t)},array:function(t){return new Lt(t.name+"[]",t)},frozen:function(t){return 0===arguments.length?_e:j(t)?new we(t):de(_e,t)},identifier:Ne,identifierNumber:je,late:function(t,e){var n="string"==typeof t?t:"late("+t.toString()+")";return new me(n,"string"==typeof t?e:t)},undefined:ie,null:re,snapshotProcessor:function(t,e,n){return new Rt(t,e,n)}};t.typecheck=B,t.escapeJsonPath=Nt,t.unescapeJsonPath=jt,t.joinJsonPath=Dt,t.splitJsonPath=xt,t.decorate=function(t,e){var n={handler:t,includeHooks:!0};return e.$mst_middleware&&e.$mst_middleware.push(n),e.$mst_middleware=[n],e},t.addMiddleware=U,t.process=function(t){return Vt("process","`process()` has been renamed to `flow()`. See https://github.com/mobxjs/mobx-state-tree/issues/399 for more information. Note that the middleware event types starting with `process` now start with `flow`."),Ot(t)},t.isStateTreeNode=nt,t.flow=Ot,t.castFlowReturn=function(t){return t},t.applyAction=R,t.onAction=k,t.recordActions=function(t){var e=[],n={actions:e,stop:function(){return r()},replay:function(t){R(t,e)}},r=k(t,e.push.bind(n.actions));return n},t.createActionTrackingMiddleware=function(a){return function(e,t,n){switch(e.type){case"action":if(a.filter&&!0!==a.filter(e))return t(e);var r=a.onStart(e);a.onResume(e,r),D.set(e.id,{call:e,context:r,async:!1});try{var i=t(e);return a.onSuspend(e,r),!1===D.get(e.id).async&&(D.delete(e.id),a.onSuccess(e,r,i)),i}catch(t){throw D.delete(e.id),a.onFail(e,r,t),t}case"flow_spawn":return(o=D.get(e.rootId)).async=!0,t(e);case"flow_resume":case"flow_resume_error":var o=D.get(e.rootId);a.onResume(e,o.context);try{return t(e)}finally{a.onSuspend(e,o.context)}case"flow_throw":return o=D.get(e.rootId),D.delete(e.rootId),a.onFail(e,o.context,e.args[0]),t(e);case"flow_return":return o=D.get(e.rootId),D.delete(e.rootId),a.onSuccess(e,o.context,e.args[0]),t(e)}}},t.setLivelinessChecking=r,t.getLivelinessChecking=i,t.setLivelynessChecking=function(t){r(t)},t.getType=u,t.getChildType=function(t,e){return rt(t).getChildType(e)},t.onPatch=f,t.onSnapshot=function(t,e){return rt(t).onSnapshot(e)},t.applyPatch=l,t.recordPatches=function(e){var t=null;function n(){t||(t=f(e,function(t,e){r.rawPatches.push([t,e])}))}var r={rawPatches:[],get patches(){return this.rawPatches.map(function(t){return t[0]})},get inversePatches(){return this.rawPatches.map(function(t){return t[0],t[1]})},stop:function(){t&&t(),t=null},resume:n,replay:function(t){l(t||e,r.patches)},undo:function(t){l(t||e,r.inversePatches.slice().reverse())}};return n(),r},t.protect=function(t){var e=rt(t);if(!e.isRoot)throw dt("`protect` can only be invoked on root nodes");e.isProtectionEnabled=!0},t.unprotect=function(t){var e=rt(t);if(!e.isRoot)throw dt("`unprotect` can only be invoked on root nodes");e.isProtectionEnabled=!1},t.isProtected=function(t){return rt(t).isProtected},t.applySnapshot=d,t.getSnapshot=function(t,e){void 0===e&&(e=!0);var n=rt(t);return e?n.snapshot:St(n.type.getSnapshot(n,!1))},t.hasParent=function(t,e){void 0===e&&(e=1);for(var n=rt(t).parent;n;){if(0==--e)return!0;n=n.parent}return!1},t.getParent=function(t,e){void 0===e&&(e=1);for(var n=e,r=rt(t).parent;r;){if(0==--n)return r.storedValue;r=r.parent}throw dt("Failed to find the parent of "+rt(t)+" at depth "+e)},t.hasParentOfType=function(t,e){for(var n=rt(t).parent;n;){if(e.is(n.storedValue))return!0;n=n.parent}return!1},t.getParentOfType=function(t,e){for(var n=rt(t).parent;n;){if(e.is(n.storedValue))return n.storedValue;n=n.parent}throw dt("Failed to find the parent of "+rt(t)+" of a given type")},t.getRoot=y,t.getPath=v,t.getPathParts=function(t){return xt(rt(t).path)},t.isRoot=function(t){return rt(t).isRoot},t.resolvePath=function(t,e){var n=ut(rt(t),e);return n?n.value:void 0},t.resolveIdentifier=function(t,e,n){var r=rt(e).root.identifierCache.resolve(t,De(n));return r?r.value:void 0},t.getIdentifier=b,t.tryResolve=g,t.getRelativePath=function(t,e){return st(rt(t),rt(e))},t.clone=function(t,e){void 0===e&&(e=!0);var n=rt(t);return n.type.create(n.snapshot,!0===e?n.root.environment:!1===e?void 0:e)},t.detach=function(t){return rt(t).detach(),t},t.destroy=function(t){var e=rt(t);e.isRoot?e.die():e.parent.removeChild(e.subpath)},t.isAlive=m,t.addDisposer=function(t,e){return rt(t).addDisposer(e),e},t.getEnv=function(t){var e=rt(t).root.environment;return e||ft},t.walk=function e(t,n){var r=rt(t);r.getChildren().forEach(function(t){nt(t.storedValue)&&e(t.storedValue,n)}),n(r.storedValue)},t.getMembers=function(n){var t=rt(n).type,r=a({},w(t),{actions:[],volatile:[],views:[]});return Object.getOwnPropertyNames(n).forEach(function(t){if(!(t in r.properties)){var e=Object.getOwnPropertyDescriptor(n,t);e.get?c.isComputedProp(n,t)?r.views.push(t):r.volatile.push(t):!0===e.value._isMSTAction?r.actions.push(t):c.isObservableProp(n,t)?r.volatile.push(t):r.views.push(t)}}),r},t.getPropertyMembers=w,t.cast=function(t){return t},t.castToSnapshot=function(t){return t},t.castToReferenceSnapshot=function(t){return t},t.isType=j,t.isArrayType=function(t){return j(t)&&0<(t.flags&_.Array)},t.isFrozenType=function(t){return j(t)&&0<(t.flags&_.Frozen)},t.isIdentifierType=function(t){return j(t)&&0<(t.flags&_.Identifier)},t.isLateType=function(t){return j(t)&&0<(t.flags&_.Late)},t.isLiteralType=function(t){return j(t)&&0<(t.flags&_.Literal)},t.isMapType=function(t){return j(t)&&0<(t.flags&_.Map)},t.isModelType=qt,t.isOptionalType=function(t){return j(t)&&0<(t.flags&_.Optional)},t.isPrimitiveType=se,t.isReferenceType=function(t){return 0<(t.flags&_.Reference)},t.isRefinementType=function(t){return 0<(t.flags&_.Refinement)},t.isUnionType=function(t){return 0<(t.flags&_.Union)},t.tryReference=function(t,e){void 0===e&&(e=!0);try{var n=t();if(null==n)return;if(nt(n))return e?m(n)?n:void 0:n;throw dt("The reference to be checked is not one of node, null or undefined")}catch(t){if(t instanceof Pe)return;throw t}},t.isValidReference=function(t,e){void 0===e&&(e=!0);try{var n=t();if(null==n)return!1;if(nt(n))return!e||m(n);throw dt("The reference to be checked is not one of node, null or undefined")}catch(t){if(t instanceof Pe)return!1;throw t}},t.types=Re,Object.defineProperty(t,"__esModule",{value:!0})});
